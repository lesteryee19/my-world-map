<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å¯ç·¨è¼¯ä¸–ç•Œåœ°åœ–</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* è¨­å®šåœ°åœ–èˆ‡é é¢æ¨£å¼ */
        body { margin: 0; padding: 0; font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f4f4; }
        header { background: #333; color: white; padding: 10px; text-align: center; }
        #map { height: 80vh; width: 95%; margin: 10px auto; border: 2px solid #333; border-radius: 8px; }
        .controls { text-align: center; margin: 10px; }
        button { 
            padding: 8px 16px; 
            background-color: #e74c3c; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px;
        }
        button:hover { background-color: #c0392b; }
    </style>
</head>
<body>

    <header>
        <h1>æˆ‘çš„è‡ªè¨‚ç·¨è¼¯åœ°åœ–</h1>
    </header>

    <div class="controls">
        <button onclick="clearMap()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ¨™è¨˜</button>
        <p style="font-size: 0.9em; color: #666;">æç¤ºï¼šé»æ“Šåœ°åœ–ä»»ä½•åœ°æ–¹å³å¯æ–°å¢æ¨™è¨˜</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
    // åˆå§‹åŒ–åœ°åœ–ï¼šé‡é»åœ¨æ–¼ worldCopyJump èˆ‡ minZoom/maxZoom çš„é…åˆ
    const map = L.map('map', {
        worldCopyJump: true,      // ç•¶ä½ æ»‘éç¶“ç·š 180 åº¦æ™‚ï¼Œå®ƒæœƒè‡ªå‹•æŠŠä½ ã€Œå‚³é€ã€å›åŸé»ï¼Œå¯¦ç¾ç„¡é™å¾ªç’°
        center: [20, 0],          // åˆå§‹ä¸­å¿ƒé»
        zoom: 2,                  // åˆå§‹ç¸®æ”¾
        minZoom: 2,               // é™åˆ¶æœ€å°ç¸®æ”¾ï¼Œé¿å…ç¸®å¤ªå°æ™‚åŒæ™‚çœ‹åˆ°å…©å€‹ä¸–ç•Œ
        maxBoundsViscosity: 0.5,
        bounceAtZoomLimits: true
    });

    // æ›ä¸Šä¸€å€‹æ›´åƒ Google Maps çš„ä¹¾æ·¨åº•åœ–
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap',
        noWrap: false             // å¿…é ˆè¨­ç‚º falseï¼Œåœ°åœ–æ‰æœƒé€£çºŒæ‹¼æ¥
    }).addTo(map);

    // --- ä»¥ä¸‹æ˜¯ä½ åŸæœ¬çš„ LocalStorage å­˜æª”åŠŸèƒ½ ---
    let savedLocations = JSON.parse(localStorage.getItem('my_map_marks')) || [];
    savedLocations.forEach(loc => {
        L.marker([loc.lat, loc.lng]).addTo(map).bindPopup(loc.text);
    });

    map.on('click', function(e) {
        const text = prompt("ä½ æƒ³ç‚ºé€™å€‹åœ°é»æ¨™è¨»ä»€éº¼ï¼Ÿ");
        if (text) {
            L.marker(e.latlng).addTo(map).bindPopup(text).openPopup();
            const newLoc = { lat: e.latlng.lat, lng: e.latlng.lng, text: text };
            savedLocations.push(newLoc);
            localStorage.setItem('my_map_marks', JSON.stringify(savedLocations));
        }
    });

    function clearMap() {
        if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰æ¨™è¨˜å—ï¼Ÿ")) {
            localStorage.removeItem('my_map_marks');
            location.reload();
        }
    }
</script>
    </script>
</body>
</html>
