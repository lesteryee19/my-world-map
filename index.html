<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å¯ç·¨è¼¯ä¸–ç•Œåœ°åœ–</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* è¨­å®šåœ°åœ–èˆ‡é é¢æ¨£å¼ */
        body { margin: 0; padding: 0; font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f4f4; }
        header { background: #333; color: white; padding: 10px; text-align: center; }
        #map { height: 80vh; width: 95%; margin: 10px auto; border: 2px solid #333; border-radius: 8px; }
        .controls { text-align: center; margin: 10px; }
        button { 
            padding: 8px 16px; 
            background-color: #e74c3c; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px;
        }
        button:hover { background-color: #c0392b; }
    </style>
</head>
<body>

    <header>
        <h1>æˆ‘çš„è‡ªè¨‚ç·¨è¼¯åœ°åœ–</h1>
    </header>

    <div class="controls">
        <button onclick="clearMap()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ¨™è¨˜</button>
        <p style="font-size: 0.9em; color: #666;">æç¤ºï¼šé»æ“Šåœ°åœ–ä»»ä½•åœ°æ–¹å³å¯æ–°å¢æ¨™è¨˜</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // 1. åˆå§‹åŒ–åœ°åœ–ï¼šä¸­å¿ƒé»è¨­åœ¨ [20, 0]ï¼Œç¸®æ”¾ç­‰ç´š 2
        const map = L.map('map').setView([20, 0], 2);

        // 2. è¼‰å…¥åº•åœ– (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // 3. å¾ LocalStorage è®€å–èˆŠè³‡æ–™
        let savedLocations = JSON.parse(localStorage.getItem('my_map_marks')) || [];

        // 4. ç¶²é é–‹å•Ÿæ™‚ï¼ŒæŠŠå­˜éçš„é»ç•«å‡ºä¾†
        savedLocations.forEach(loc => {
            L.marker([loc.lat, loc.lng]).addTo(map).bindPopup(loc.text);
        });

        // 5. é»æ“Šåœ°åœ–çš„æ–°å¢é‚è¼¯
        map.on('click', function(e) {
            const text = prompt("ä½ æƒ³ç‚ºé€™å€‹åœ°é»æ¨™è¨»ä»€éº¼ï¼Ÿ");
            
            if (text) {
                // åœ¨åœ°åœ–ä¸Šç•«å‡ºåœ–é‡˜
                L.marker(e.latlng).addTo(map).bindPopup(text).openPopup();

                // å„²å­˜è³‡æ–™åˆ°é™£åˆ—
                const newLoc = {
                    lat: e.latlng.lat,
                    lng: e.latlng.lng,
                    text: text
                };
                savedLocations.push(newLoc);

                // åŒæ­¥åˆ°ç€è¦½å™¨çš„ LocalStorage (å­˜æª”)
                localStorage.setItem('my_map_marks', JSON.stringify(savedLocations));
            }
        });

        // 6. æ¸…é™¤åŠŸèƒ½çš„å‡½å¼
        function clearMap() {
            if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰æ¨™è¨˜å—ï¼Ÿé€™å‹•ä½œç„¡æ³•å¾©åŸå–”ï¼")) {
                localStorage.removeItem('my_map_marks');
                location.reload(); // é‡æ–°æ•´ç†ç¶²é 
            }
        }
    </script>
</body>
</html>